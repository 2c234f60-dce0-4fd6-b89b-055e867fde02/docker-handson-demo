# 06: 수평 스케일링

## 시나리오

소셜 미디어 애플리케이션의 컨테이너화를 성공적으로 완료했습니다! 적어도 내년에는 인프라 환경이 바뀌었다고해서 야근을 할 일은 없겠습니다. 하지만 애플리케이션이 너무도 성공적이어서 사용자 수가 기하급수적으로 늘고 있습니다.

Contoso는 이제 증가하는 트래픽을 처리하기 위해 백엔드를 수평적으로 확장하고자 합니다. 단일 프론트엔드 인스턴스를 유지하면서 백엔드 서비스의 여러 인스턴스를 실행하여 로드를 분산해야 합니다.

이제 당신은 DevOps 엔지니어로서 GitHub Copilot을 사용하여 기존 컨테이너들을 활용하여 확장 가능한 시스템을 만들어야 합니다.

## 전제 조건

- 먼저 이전 단계 step 05 (컨테이너화)를 완료하세요
- 준비 사항에 대해서는 [README](../README.md) 문서를 참고하세요

## 시작하기

- [Step-05를 workshop으로 복사](#step-05를-workshop으로-복사)
- [GitHub Copilot Agent 모드 확인](#github-copilot-agent-모드-확인)
- [스케일링을 위한 Docker Compose 수정](#스케일링을-위한-docker-compose-수정)
- [프론트엔드 구성 업데이트](#프론트엔드-구성-업데이트)
- [수평 스케일링 테스트](#수평-스케일링-테스트)

### Step-05를 workshop으로 복사

1. 먼저 `complete/step-05`에서 `workshop`으로 컨테이너화된 애플리케이션을 복사하세요:

   ```bash
   # 저장소 루트에서
   cp -r complete/step-05 workshop
   ```

   이는 GitHub Copilot을 사용하여 스케일링 기능으로 향상시킬 새 디렉터리 구조를 생성합니다.

### GitHub Copilot Agent 모드 확인

1. VS Code 상단에 있는 GitHub Copilot 아이콘을 클릭하여 GitHub Copilot 창을 열어주세요.

   ![Open GitHub Copilot Chat](./images/setup-02.png)

1. 로그인이나 가입을 요구받으면 진행하세요. 무료입니다.
1. GitHub Copilot Agent 모드를 사용하고 있는지 확인하세요.

   ![GitHub Copilot Agent Mode](./images/setup-03.png)

1. 모델을 `GPT-4.1` 또는 `Claude Sonnet 4` 중 하나로 선택하세요.

### 스케일링을 위한 Docker Compose 수정

1. `Claude Sonnet 4` 또는 `GPT-4.1` 모델로 GitHub Copilot Agent 모드를 사용하고 있는지 확인하세요.
2. 수평 스케일링을 위해 Docker Compose 파일을 수정하기 위해 다음 프롬프트를 사용하세요:

    ```text
    백엔드의 수평 스케일링을 지원하도록 Docker Compose 파일을 수정하고 싶습니다. 아래 지시사항을 따라주세요.

    - 먼저 수행할 모든 단계를 식별하세요.
    - Docker Compose 파일은 `workshop/docker-compose.yml`에 위치해 있습니다.
    - 작업 디렉터리는 저장소 루트입니다.
    - 여러 인스턴스를 허용하기 위해 백엔드 서비스에서 `container_name`을 제거하세요.
    - 백엔드 서비스가 내부에서만 접근 가능하도록 명시적인 `ports` 매핑을 제거하세요.
    - 프론트엔드 서비스는 포트가 노출된 단일 인스턴스로 유지하세요.
    - 네트워크 이름으로 `appnet`을 사용하도록 네트워크 구성을 업데이트하세요.
    - 백엔드 서비스를 스케일하는 방법을 설명하는 주석을 추가하세요.
    - 백엔드가 데이터베이스 구성에 환경 변수를 사용하도록 하세요.
    - 상태 확인 조건 없이 `backend` 서비스에만 의존하도록 프론트엔드 의존성을 업데이트하세요.
    ```

3. 변경 사항을 반영하려면 GitHub Copilot의 ![the keep button image](https://img.shields.io/badge/keep-blue) 버튼을 클릭하세요.

### 프론트엔드 구성 업데이트

1. 프론트엔드가 스케일된 백엔드 인스턴스에 연결할 수 있도록 하기 위해 다음 프롬프트를 사용하세요:

    ```text
    스케일된 백엔드 인스턴스와 작동하도록 프론트엔드 nginx 구성을 업데이트해야 합니다. 아래 지시사항을 따라주세요.

    - 먼저 수행할 모든 단계를 식별하세요.
    - nginx 구성은 `workshop/frontend/nginx.conf`에 있습니다.
    - 작업 디렉터리는 저장소 루트입니다.
    - `/api` 프록시 패스가 Docker 서비스 이름 `backend`를 사용하도록 하세요 (Docker가 자동으로 로드 밸런싱을 수행합니다).
    - 프록시 구성이 여러 백엔드 인스턴스를 처리할 수 있도록 하세요.
    - 로드 밸런싱을 위한 적절한 프록시 헤더를 추가하세요.
    - 컨테이너 네트워킹에 최적화된 구성이 되도록 하세요.
    ```

2. 변경 사항을 반영하려면 GitHub Copilot의 ![the keep button image](https://img.shields.io/badge/keep-blue) 버튼을 클릭하세요.

### 수평 스케일링 테스트

1. 스케일된 애플리케이션을 테스트하기 위해 다음 프롬프트를 사용하세요:

    ```text
    수평적으로 스케일된 애플리케이션을 테스트하고 싶습니다. 아래 지시사항을 따라주세요.

    - 먼저 수행할 모든 단계를 식별하세요.
    - `workshop` 디렉터리로 이동하세요.
    - Docker Compose를 사용하여 스케일링과 함께 서비스를 빌드하고 시작하세요.
    - 백엔드 서비스를 3개 인스턴스로 스케일하세요.
    - 여러 백엔드 인스턴스가 실행 중인지 확인하세요.
    - 모든 백엔드 인스턴스의 로그를 확인하세요.
    - 프론트엔드를 통해 애플리케이션 기능을 테스트하세요.
    - 백엔드 인스턴스를 확장하고 축소하는 방법을 보여주세요.
    ```

2. 변경 사항을 반영하려면 GitHub Copilot의 ![the keep button image](https://img.shields.io/badge/keep-blue) 버튼을 클릭하세요.

3. 스케일링이 작동하면 다음 프롬프트로 애플리케이션을 테스트하세요:

    ```text
    스케일된 애플리케이션이 제대로 작동하는지 테스트하세요.

    - 웹 브라우저를 열고 `http://localhost:80`으로 이동하세요.
    - 백엔드 로드 분산을 테스트하기 위해 여러 게시물을 생성하세요.
    - 로드 분산을 확인하기 위해 다른 백엔드 인스턴스의 로그를 확인하세요.
    - 여러 백엔드 인스턴스와 함께 애플리케이션이 응답성을 유지하는지 확인하세요.
    ```

### 고급 스케일링 작업

1. 고급 스케일링 작업에 대해 알아보기 위해 다음 프롬프트를 사용하세요:

    ```text
    컨테이너화된 애플리케이션의 고급 스케일링 작업을 보여주세요.

    - 백엔드를 5개 인스턴스로 스케일하는 방법을 시연하세요.
    - 2개 인스턴스로 축소하는 방법을 보여주세요.
    - Docker Compose가 인스턴스 간 로드 밸런싱을 처리하는 방법을 설명하세요.
    - 모든 스케일된 인스턴스의 실시간 로그를 보는 방법을 보여주세요.
    - 다른 인스턴스에 영향을 주지 않고 개별 인스턴스를 재시작하는 방법을 시연하세요.
    ```

---

축하합니다! 🎉 GitHub Copilot을 사용하여 컴테이너화된 소셜 미디어 애플리케이션의 수평 스케일링을 성공적으로 구현했습니다! 이제 백엔드는 여러 인스턴스를 실행하여 증가한 로드를 처리할 수 있으며, 프론트엔드는 단일 로드 밸런싱 진입점 역할을 유지합니다.

## 달성한 주요 이점

- **수평 확장성**: 만반에 따라 백엔드를 확장하거나 축소할 수 있습니다
- **로드 분산**: 여러 백엔드 인스턴스가 작업 부하를 공유합니다
- **고가용성**: 한 백엔드 인스턴스가 실패해도 다른 인스턴스가 계속 요청을 처리합니다
- **쉬운 관리**: 간단한 Docker Compose 명령으로 서비스를 스케일할 수 있습니다
- **비용 효율성**: 필요할 때만 리소스를 스케일할 수 있습니다